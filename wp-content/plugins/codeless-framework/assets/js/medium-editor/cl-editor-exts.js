!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():b.rangy=a()}(function(){function h(c,d){var e=typeof c[d];return e==b||!(e!=a||!c[d])||"unknown"==e}function i(b,c){return!(typeof b[c]!=a||!b[c])}function j(a,b){return typeof a[b]!=c}function k(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function o(a){return a&&l(a,g)&&n(a,f)}function p(a){return i(a,"body")?a.body:a.getElementsByTagName("body")[0]}function v(a){typeof console!=c&&h(console,"log")&&console.log(a)}function w(a,b){s&&b?alert(a):v(a)}function x(a){u.initialized=!0,u.supported=!1,w("Rangy is not supported in this environment. Reason: "+a,u.config.alertOnFail)}function y(a){w("Rangy warning: "+a,u.config.alertOnWarn)}function C(a){return a.message||a.description||String(a)}function D(){if(s&&!u.initialized){var a,b=!1,c=!1;h(document,"createRange")&&(a=document.createRange(),l(a,e)&&n(a,d)&&(b=!0));var f=p(document);if(!f||"body"!=f.nodeName.toLowerCase())return void x("No body element found");if(f&&h(f,"createTextRange")&&(a=f.createTextRange(),o(a)&&(c=!0)),!b&&!c)return void x("Neither Range nor TextRange are available");u.initialized=!0,u.features={implementsDomRange:b,implementsTextRange:c};var g,i;for(var j in r)(g=r[j])instanceof I&&g.init(g,u);for(var k=0,m=B.length;k<m;++k)try{B[k](u)}catch(a){i="Rangy init listener threw an exception. Continuing. Detail: "+C(a),v(i)}}}function E(a,b,c){c&&(a+=" in module "+c.name),u.warn("DEPRECATED: "+a+" is deprecated. Please use "+b+" instead.")}function F(a,b,c,d){a[b]=function(){return E(b,c,d),a[c].apply(a,t.toArray(arguments))}}function H(a){a=a||window,D();for(var b=0,c=G.length;b<c;++b)G[b](a)}function I(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function J(a,b,c){var d=new I(a,b,function(b){if(!b.initialized){b.initialized=!0;try{c(u,b),b.supported=!0}catch(b){var d="Module '"+a+"' failed to load: "+C(b);v(d),b.stack&&v(b.stack)}}});return r[a]=d,d}function K(){}function L(){}var a="object",b="function",c="undefined",d=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],e=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],f=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],l=k(h),m=k(i),n=k(j),q=[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0,d=a.length;c<d;++c)b(a[c],c)},r={},s=typeof window!=c&&typeof document!=c,t={isHostMethod:h,isHostObject:i,isHostProperty:j,areHostMethods:l,areHostObjects:m,areHostProperties:n,isTextRange:o,getBody:p,forEach:q},u={version:"1.3.1-dev",initialized:!1,isBrowser:s,supported:!0,util:t,features:{},modules:r,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==c||rangyAutoInitialize}};u.fail=x,u.warn=y;var z;({}).hasOwnProperty?(t.extend=z=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&z(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a},t.createOptions=function(a,b){var c={};return z(c,b),a&&z(c,a),c}):x("hasOwnProperty not supported"),s||x("Rangy can only run in a browser"),function(){var a;if(s){var b=document.createElement("div");b.appendChild(document.createElement("span"));var c=[].slice;try{1==c.call(b.childNodes,0)[0].nodeType&&(a=function(a){return c.call(a,0)})}catch(a){}}a||(a=function(a){for(var b=[],c=0,d=a.length;c<d;++c)b[c]=a[c];return b}),t.toArray=a}();var A;s&&(h(document,"addEventListener")?A=function(a,b,c){a.addEventListener(b,c,!1)}:h(document,"attachEvent")?A=function(a,b,c){a.attachEvent("on"+b,c)}:x("Document does not have required addEventListener or attachEvent method"),t.addListener=A);var B=[];t.deprecationNotice=E,t.createAliasForDeprecatedMethod=F,u.init=D,u.addInitListener=function(a){u.initialized?a(u):B.push(a)};var G=[];u.addShimListener=function(a){G.push(a)},s&&(u.shim=u.createMissingNativeApi=H,F(u,"createMissingNativeApi","shim")),I.prototype={init:function(){for(var d,e,a=this.dependencies||[],b=0,c=a.length;b<c;++b){if(e=a[b],d=r[e],!(d&&d instanceof I))throw new Error("required module '"+e+"' not found");if(d.init(),!d.supported)throw new Error("required module '"+e+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error(a)},warn:function(a){u.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){u.warn("DEPRECATED: "+a+" in module "+this.name+" is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},u.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]);var d=J(a,c,b);u.initialized&&u.supported&&d.init()},u.createCoreModule=function(a,b,c){J(a,b,c)},u.RangePrototype=K,u.rangePrototype=new K,u.selectionPrototype=new L,u.createCoreModule("DomUtil",[],function(a,b){function i(a){var b;return typeof a.namespaceURI==c||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function j(a){var b=a.parentNode;return 1==b.nodeType?b:null}function k(a){for(var b=0;a=a.previousSibling;)++b;return b}function l(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function m(a,b){var d,c=[];for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(h(c,d))return d;return null}function n(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function o(a,b){return n(a,b,!0)}function p(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function q(a){var b=a.nodeType;return 3==b||4==b||8==b}function r(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function s(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function t(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),s(d,a),c)for(var f,e=0;f=c[e++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>k(a)&&++f.offset;return d}function u(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=c)return a.ownerDocument;if(typeof a.document!=c)return a.document;if(a.parentNode)return u(a.parentNode);throw b.createError("getDocument: no document found for node")}function v(a){var d=u(a);if(typeof d.defaultView!=c)return d.defaultView;if(typeof d.parentWindow!=c)return d.parentWindow;throw b.createError("Cannot get a window object for node")}function w(a){if(typeof a.contentDocument!=c)return a.contentDocument;if(typeof a.contentWindow!=c)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function x(a){if(typeof a.contentWindow!=c)return a.contentWindow;if(typeof a.contentDocument!=c)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function y(a){return a&&d.isHostMethod(a,"setTimeout")&&d.isHostObject(a,"document")}function z(a,b,c){var e;if(a?d.isHostProperty(a,"nodeType")?e=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?w(a):u(a):y(a)&&(e=a.document):e=document,!e)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return e}function A(a){for(var b;b=a.parentNode;)a=b;return a}function B(a,c,d,e){var f,g,h,i,j;if(a==d)return c===e?0:c<e?-1:1;if(f=p(d,a,!0))return c<=k(f)?-1:1;if(f=p(a,d,!0))return k(f)<e?-1:1;if(g=m(a,d),!g)throw new Error("comparePoints error: nodes have no common ancestor");if(h=a===g?g:p(a,g,!0),i=d===g?g:p(d,g,!0),h===i)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(j=g.firstChild;j;){if(j===h)return-1;if(j===i)return 1;j=j.nextSibling}}function D(a){var b;try{return b=a.parentNode,!1}catch(a){return!0}}function E(a){if(!a)return"[No node]";if(C&&D(a))return"[Broken node]";if(q(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+k(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function F(a){for(var c,b=u(a).createDocumentFragment();c=a.firstChild;)b.appendChild(c);return b}function H(a,b,c){var d=e(a),f=a.createElement("div");f.contentEditable=""+!!c,b&&(f.innerHTML=b);var g=d.firstChild;return g?d.insertBefore(f,g):d.appendChild(f),f}function I(a){return a.parentNode.removeChild(a)}function J(a){this.root=a,this._next=a}function K(a){return new J(a)}function L(a,b){this.node=a,this.offset=b}function M(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var c="undefined",d=a.util,e=d.getBody;d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),d.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var f=document.createElement("div");d.areHostMethods(f,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(f,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),d.isHostProperty(f,"innerHTML")||b.fail("Element is missing innerHTML property");var g=document.createTextNode("test");d.areHostMethods(g,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(f,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(g,["data"]))||b.fail("Incomplete Text Node implementation");var h=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},C=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br />",C=D(c),a.features.crashyTextNodes=C}();var G;typeof window.getComputedStyle!=c?G=function(a,b){return v(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=c?G=function(a,b){return a.currentStyle?a.currentStyle[b]:""}:b.fail("No means of obtaining computed style properties found"),J.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var b,c,a=this._current=this._next;if(this._current)if(b=a.firstChild)this._next=b;else{for(c=null;a!==this.root&&!(c=a.nextSibling);)a=a.parentNode;this._next=c}return this._current},detach:function(){this._current=this._next=this.root=null}},L.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+E(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},M.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},M.prototype.toString=function(){return this.message},a.dom={arrayContains:h,isHtmlNamespace:i,parentElement:j,getNodeIndex:k,getNodeLength:l,getCommonAncestor:m,isAncestorOf:n,isOrIsAncestorOf:o,getClosestAncestorIn:p,isCharacterDataNode:q,isTextOrCommentNode:r,insertAfter:s,splitDataNode:t,getDocument:u,getWindow:v,getIframeWindow:x,getIframeDocument:w,getBody:e,isWindow:y,getContentDocument:z,getRootContainer:A,comparePoints:B,isBrokenNode:D,inspectNode:E,getComputedStyleProperty:G,createTestElement:H,removeNode:I,fragmentFromNodeChildren:F,createIterator:K,DomPosition:L},a.DOMException=M}),u.createCoreModule("DomRange",["DomUtil"],function(a,b){function s(a,b){return 3!=a.nodeType&&(i(a,b.startContainer)||i(a,b.endContainer))}function t(a){return a.document||j(a.startContainer)}function u(a){return p(a.startContainer)}function v(a){return new e(a.parentNode,h(a))}function w(a){return new e(a.parentNode,h(a)+1)}function x(a,b,d){var e=11==a.nodeType?a.firstChild:a;return g(b)?d==b.length?c.insertAfter(a,b):b.parentNode.insertBefore(a,0==d?b:l(b,d)):d>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[d]),e}function y(a,b,c){if(X(a),X(b),t(b)!=t(a))throw new f("WRONG_DOCUMENT_ERR");var d=k(a.startContainer,a.startOffset,b.endContainer,b.endOffset),e=k(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?d<=0&&e>=0:d<0&&e>0}function z(a){for(var b,c,e,d=t(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(e=a.getSubtreeIterator(),c.appendChild(z(e)),e.detach()),10==c.nodeType)throw new f("HIERARCHY_REQUEST_ERR");d.appendChild(c)}return d}function A(a,b,d){var e,f;d=d||{stop:!1};for(var g,h;g=a.next();)if(a.isPartiallySelectedSubtree()){if(b(g)===!1)return void(d.stop=!0);if(h=a.getSubtreeIterator(),A(h,b,d),h.detach(),d.stop)return}else for(e=c.createIterator(g);f=e.next();)if(b(f)===!1)return void(d.stop=!0)}function B(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),B(b),b.detach()):a.remove()}function C(a){for(var b,d,c=t(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(C(d)),d.detach()):a.remove(),10==b.nodeType)throw new f("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function D(a,b,c){var e,d=!(!b||!b.length),f=!!c;d&&(e=new RegExp("^("+b.join("|")+")$"));var h=[];return A(new F(a,!1),function(b){if((!d||e.test(b.nodeType))&&(!f||c(b))){var i=a.startContainer;if(b!=i||!g(i)||a.startOffset!=i.length){var j=a.endContainer;b==j&&g(j)&&0==a.endOffset||h.push(b)}}}),h}function E(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+c.inspectNode(a.startContainer)+":"+a.startOffset+", "+c.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function F(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&g(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||g(this.sc)?m(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||g(this.ec)?m(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function L(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,o(a,d))return e;e=e.parentNode}return null}}function P(a,b){if(O(a,b))throw new f("INVALID_NODE_TYPE_ERR")}function Q(a,b){if(!o(b,a.nodeType))throw new f("INVALID_NODE_TYPE_ERR")}function R(a,b){if(b<0||b>(g(a)?a.length:a.childNodes.length))throw new f("INDEX_SIZE_ERR")}function S(a,b){if(M(a,!0)!==M(b,!0))throw new f("WRONG_DOCUMENT_ERR")}function T(a){if(N(a,!0))throw new f("NO_MODIFICATION_ALLOWED_ERR")}function U(a,b){if(!a)throw new f(b)}function V(a,b){return b<=(g(a)?a.length:a.childNodes.length)}function W(a){return!!a.startContainer&&!!a.endContainer&&!(q&&(c.isBrokenNode(a.startContainer)||c.isBrokenNode(a.endContainer)))&&p(a.startContainer)==p(a.endContainer)&&V(a.startContainer,a.startOffset)&&V(a.endContainer,a.endOffset)}function X(a){if(!W(a))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+a.inspect()+")")}function _(a,b){X(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,i=c===e;g(e)&&f>0&&f<e.length&&l(e,f,b),g(c)&&d>0&&d<c.length&&(c=l(c,d,b),i?(f-=d,e=c):e==c.parentNode&&f>=h(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function aa(a){X(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);return b.appendChild(a.cloneContents()),b.innerHTML}function ka(a){a.START_TO_START=ca,a.START_TO_END=da,a.END_TO_END=ea,a.END_TO_START=fa,a.NODE_BEFORE=ga,a.NODE_AFTER=ha,a.NODE_BEFORE_AND_AFTER=ia,a.NODE_INSIDE=ja}function la(a){ka(a),ka(a.prototype)}function ma(a,b){return function(){X(this);var g,h,c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,f=new F(this,!0);c!==e&&(g=m(c,e,!0),h=w(g),c=h.node,d=h.offset),A(f,T),f.reset();var i=a(f);return f.detach(),b(this,c,d,c,d),i}}function na(b,c){function e(a,b){return function(c){Q(c,G),Q(p(c),H);var d=(a?v:w)(c);(b?f:i)(this,d.node,d.offset)}}function f(a,b,d){var e=a.endContainer,f=a.endOffset;b===a.startContainer&&d===a.startOffset||(p(b)==p(e)&&1!=k(b,d,e,f)||(e=b,f=d),c(a,b,d,e,f))}function i(a,b,d){var e=a.startContainer,f=a.startOffset;b===a.endContainer&&d===a.endOffset||(p(b)==p(e)&&k(b,d,e,f)!=-1||(e=b,f=d),c(a,e,f,b,d))}var j=function(){};j.prototype=a.rangePrototype,b.prototype=new j,d.extend(b.prototype,{setStart:function(a,b){P(a,!0),R(a,b),f(this,a,b)},setEnd:function(a,b){P(a,!0),R(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],d=a[1],e=b,f=d;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}c(this,b,d,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(a){X(this),a?c(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):c(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){P(a,!0),c(this,a,0,a,n(a))},selectNode:function(a){P(a,!1),Q(a,G);var b=v(a),d=w(a);c(this,b.node,b.offset,d.node,d.offset)},extractContents:ma(C,c),deleteContents:ma(B,c),canSurroundContents:function(){X(this),T(this.startContainer),T(this.endContainer);var a=new F(this,!0),b=a._first&&s(a._first,this)||a._last&&s(a._last,this);return a.detach(),!b},splitBoundaries:function(){_(this)},splitBoundariesPreservingPositions:function(a){_(this,a)},normalizeBoundaries:function(){X(this);var k,a=this.startContainer,b=this.startOffset,d=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(d=a,e=a.length,a.appendData(b.data),r(b))},i=function(c){var f=c.previousSibling;if(f&&f.nodeType==c.nodeType){a=c;var g=c.length;if(b=f.length,c.insertData(0,f.data),r(f),a==d)e+=b,d=a;else if(d==c.parentNode){var i=h(c);e==i?(d=c,e=g):e>i&&e--}}},j=!0;if(g(d))e==d.length?f(d):0==e&&(k=d.previousSibling,k&&k.nodeType==d.nodeType&&(e=k.length,a==d&&(j=!1),k.appendData(d.data),r(d),d=k));else{if(e>0){var l=d.childNodes[e-1];l&&g(l)&&f(l)}j=!this.collapsed}if(j){if(g(a))0==b?i(a):b==a.length&&(k=a.nextSibling,k&&k.nodeType==a.nodeType&&(d==k&&(d=a,e+=a.length),a.appendData(k.data),r(k)));else if(b<a.childNodes.length){var m=a.childNodes[b];m&&g(m)&&i(m)}}else a=d,b=e;c(this,a,b,d,e)},collapseToPoint:function(a,b){P(a,!0),R(a,b),this.setStartAndEnd(a,b)}}),la(b)}function oa(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:c.getCommonAncestor(a.startContainer,a.endContainer)}function pa(a,b,d,e,f){a.startContainer=b,a.startOffset=d,a.endContainer=e,a.endOffset=f,a.document=c.getDocument(b),oa(a)}function qa(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,oa(this)}var c=a.dom,d=a.util,e=c.DomPosition,f=a.DOMException,g=c.isCharacterDataNode,h=c.getNodeIndex,i=c.isOrIsAncestorOf,j=c.getDocument,k=c.comparePoints,l=c.splitDataNode,m=c.getClosestAncestorIn,n=c.getNodeLength,o=c.arrayContains,p=c.getRootContainer,q=a.features.crashyTextNodes,r=c.removeNode;F.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,g(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var b,c,a=this._current;!g(a)||a!==this.sc&&a!==this.ec?a.parentNode&&r(a):(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b))},isPartiallySelectedSubtree:function(){var a=this._current;return s(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new qa(t(this.range));var b=this._current,c=b,d=0,e=b,f=n(b);i(b,this.sc)&&(c=this.sc,d=this.so),i(b,this.ec)&&(e=this.ec,f=this.eo),pa(a,c,d,e,f)}return new F(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var G=[1,3,4,5,7,8,10],H=[2,9,11],I=[5,6,10,12],J=[1,3,4,5,7,8,10,11],K=[1,3,4,5,7,8],M=L([9,11]),N=L(I),O=L([6,10,12]),Y=document.createElement("style"),Z=!1;try{Y.innerHTML="<b>x</b>",Z=3==Y.firstChild.nodeType}catch(a){}a.features.htmlParsingConforms=Z;var $=Z?function(a){var b=this.startContainer,d=j(b);if(!b)throw new f("INVALID_STATE_ERR");var e=null;return 1==b.nodeType?e=b:g(b)&&(e=c.parentElement(b)),e=null===e||"HTML"==e.nodeName&&c.isHtmlNamespace(j(e).documentElement)&&c.isHtmlNamespace(e)?d.createElement("body"):e.cloneNode(!1),e.innerHTML=a,c.fragmentFromNodeChildren(e)}:function(a){var b=t(this),d=b.createElement("body");return d.innerHTML=a,c.fragmentFromNodeChildren(d)},ba=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ca=0,da=1,ea=2,fa=3,ga=0,ha=1,ia=2,ja=3;d.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){X(this),S(this.startContainer,b.startContainer);var c,d,e,f,g=a==fa||a==ca?"start":"end",h=a==da||a==ca?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],k(c,d,e,f)},insertNode:function(a){if(X(this),Q(a,J),T(this.startContainer),i(a,this.startContainer))throw new f("HIERARCHY_REQUEST_ERR");var b=x(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){X(this);var a,b;if(this.collapsed)return t(this).createDocumentFragment();if(this.startContainer===this.endContainer&&g(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=t(this).createDocumentFragment(),b.appendChild(a),b;var c=new F(this,!0);return a=z(c),c.detach(),a},canSurroundContents:function(){X(this),T(this.startContainer),T(this.endContainer);var a=new F(this,!0),b=a._first&&s(a._first,this)||a._last&&s(a._last,this);return a.detach(),!b},surroundContents:function(a){if(Q(a,K),!this.canSurroundContents())throw new f("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);x(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){X(this);for(var c,a=new qa(t(this)),b=ba.length;b--;)c=ba[b],a[c]=this[c];return a},toString:function(){X(this);var a=this.startContainer;if(a===this.endContainer&&g(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new F(this,!0);return A(c,function(a){3!=a.nodeType&&4!=a.nodeType||b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){X(this);var b=a.parentNode,c=h(a);if(!b)throw new f("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return d<0?e>0?ia:ga:e>0?ha:ja},comparePoint:function(a,b){return X(this),U(a,"HIERARCHY_REQUEST_ERR"),S(a,this.startContainer),k(a,b,this.startContainer,this.startOffset)<0?-1:k(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:$,toHtml:function(){return aa(this)},intersectsNode:function(a,b){if(X(this),p(a)!=u(this))return!1;var c=a.parentNode,d=h(a);if(!c)return!0;var e=k(c,d,this.endContainer,this.endOffset),f=k(c,d+1,this.startContainer,this.startOffset);return b?e<=0&&f>=0:e<0&&f>0},isPointInRange:function(a,b){return X(this),U(a,"HIERARCHY_REQUEST_ERR"),S(a,this.startContainer),k(a,b,this.startContainer,this.startOffset)>=0&&k(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return y(this,a,!1)},intersectsOrTouchesRange:function(a){return y(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=k(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=k(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return b==-1&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return k(a.startContainer,a.startOffset,this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset),1==k(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new f("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==ja},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,n(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();return b.setEnd(d,d.length),this.containsRange(b)}return this.containsNodeContents(a)},getNodes:function(a,b){return X(this),D(this,a,b)},getDocument:function(){return t(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var d=t(this),e=a.createRange(d);b=b||c.getBody(d),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var e,h,i,j,d=[b],f=!1,g=!1;!g&&(e=d.pop());)if(3==e.nodeType)h=c+e.length,!f&&a.start>=c&&a.start<=h&&(this.setStart(e,a.start-c),f=!0),f&&a.end>=c&&a.end<=h&&(this.setEnd(e,a.end-c),g=!0),c=h;else for(j=e.childNodes,i=j.length;i--;)d.push(j[i])},getName:function(){return"DomRange"},equals:function(a){return qa.rangesEqual(this,a)},isValid:function(){return W(this)},inspect:function(){return E(this)},detach:function(){}}),na(qa,pa),d.extend(qa,{rangeProperties:ba,RangeIterator:F,copyComparisonConstants:la,createPrototypeRange:na,inspect:E,toHtml:aa,getRangeDocument:t,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=qa}),u.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function k(a){for(var c,b=g.length;b--;)c=g[b],a[c]=a.nativeRange[c];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function l(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var d,m,g=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,k(this)},h.createPrototypeRange(c,l),d=c.prototype,d.selectNode=function(a){this.nativeRange.selectNode(a),k(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(a){this.nativeRange.surroundContents(a),k(this)},d.collapse=function(a){this.nativeRange.collapse(a),k(this)},d.cloneRange=function(){return new c(this.nativeRange.cloneRange())},d.refresh=function(){k(this)},d.toString=function(){return this.nativeRange.toString()};var n=document.createTextNode("test");i(document).appendChild(n);var o=document.createRange();o.setStart(n,0),o.setEnd(n,0);try{o.setStart(n,1),d.setStart=function(a,b){this.nativeRange.setStart(a,b),k(this)},d.setEnd=function(a,b){this.nativeRange.setEnd(a,b),k(this)},m=function(a){return function(b){this.nativeRange[a](b),k(this)}}}catch(a){d.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}k(this)},d.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}k(this)},m=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}k(this)}}}d.setStartBefore=m("setStartBefore","setEndBefore"),d.setStartAfter=m("setStartAfter","setEndAfter"),d.setEndBefore=m("setEndBefore","setStartBefore"),d.setEndAfter=m("setEndAfter","setStartAfter"),d.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},o.selectNodeContents(n),o.setEnd(n,3);var p=document.createRange();p.selectNodeContents(n),p.setEnd(n,4),p.setStart(n,2),o.compareBoundaryPoints(o.START_TO_END,p)==-1&&1==o.compareBoundaryPoints(o.END_TO_START,p)?d.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:d.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var q=document.createElement("div");q.innerHTML="123";var r=q.firstChild,s=i(document);s.appendChild(q),o.setStart(r,1),o.setEnd(r,2),o.deleteContents(),"13"==r.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),k(this)},d.extractContents=function(){var a=this.nativeRange.extractContents();return k(this),a}),s.removeChild(q),s=null,f.isHostMethod(o,"createContextualFragment")&&(d.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(n),d.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&e.removeNode(l);for(var m,o,p,q,r,n=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(n,a),0==m||s==u)break;if(m==-1){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(r=l.nextSibling,m==-1&&r&&k(r)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(r.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);(m=x.compareEndPoints("StartToEnd",x))==-1;)w++,x.moveStart("character",1)}else w=h.text.length;q=new g(r,w)}else o=(d||!c)&&l.previousSibling,p=(d||c)&&l.nextSibling,q=p&&k(p)?new g(p,0):o&&k(o)?new g(o,o.data.length):new g(i,e.getNodeIndex(l));return e.removeNode(l),{boundaryPosition:q,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,h,j,f=a.offset,g=e.getDocument(a.node),l=i(g).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(j=a.node.childNodes,c=f<j.length?j[f]:null,d=a.node),h=g.createElement("span"),h.innerHTML="&#feff;",c?d.insertBefore(h,c):d.appendChild(h),l.moveToElementText(h),l.collapse(!b),d.removeChild(h),m&&l[b?"moveStart":"moveEnd"]("character",f),l};d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),
d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d);var p=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d};if(d.rangeToTextRange=p,d.prototype.toTextRange=function(){return p(this)},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var q=function(a){return a("return this;")()}(Function);"undefined"==typeof q.Range&&(q.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},f.createAliasForDeprecatedMethod(a,"createIframeRange","createRange"),f.createAliasForDeprecatedMethod(a,"createIframeRangyRange","createRangyRange"),a.addShimListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),u.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function s(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function t(a,c){if(a){if(e.isWindow(a))return a;if(a instanceof W)return a.win;var d=e.getContentDocument(a,b,c);return e.getWindow(d)}return window}function u(a){return t(a,"getWinSelection").getSelection()}function v(a){return t(a,"getDocSelection").document.selection}function w(a){var b=!1;return a.anchorNode&&(b=1==e.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function L(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function M(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function N(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function O(b){var c;return b instanceof h?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof i?c=b.nativeRange:n.implementsDomRange&&b instanceof e.getWindow(b.startContainer).Range&&(c=b),c}function P(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;b<c;++b)if(!e.isAncestorOf(a[0],a[b]))return!1;return!0}function Q(a){var c=a.getNodes();if(!P(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function R(a){return!!a&&"undefined"!=typeof a.text}function S(a,b){var c=new i(b);a._ranges=[c],L(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function T(b){if(b._ranges.length=0,"None"==b.docSelection.type)N(b);else{var c=b.docSelection.createRange();if(R(c))S(b,c);else{b.rangeCount=c.length;for(var d,e=p(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,L(b,b._ranges[b.rangeCount-1],!1)}}}function U(a,c){for(var d=a.docSelection.createRange(),e=Q(c),f=p(d.item(0)),g=q(f).createControlRange(),h=0,i=d.length;h<i;++h)g.add(d.item(h));try{g.add(e)}catch(a){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),T(a)}function W(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function X(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function Z(a,b){for(var d,e,c=Y.length;c--;)if(d=Y[c],e=d.selection,"deleteAll"==b)X(e);else if(d.win==a)return"delete"==b?(Y.splice(c,1),!0):e;return"deleteAll"==b&&(Y.length=0),null}function aa(a,c){for(var g,d=p(c[0].startContainer),e=q(d).createControlRange(),f=0,h=c.length;f<h;++f){g=Q(c[f]);try{e.add(g)}catch(a){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}e.select(),T(a)}function fa(a,b){if(a.win.document!=p(b))throw new j("WRONG_DOCUMENT_ERR")}function ga(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function ha(a){var b=[],c=new k(a.anchorNode,a.anchorOffset),d=new k(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;f<g;++f)b[f]=h.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var l,m,c="boolean",d="number",e=a.dom,f=a.util,g=f.isHostMethod,h=a.DomRange,i=a.WrappedRange,j=a.DOMException,k=e.DomPosition,n=a.features,o="Control",p=e.getDocument,q=e.getBody,r=h.rangesEqual,x=g(window,"getSelection"),y=f.isHostObject(document,"selection");n.implementsWinGetSelection=x,n.implementsDocSelection=y;var z=y&&(!x||a.config.preferTextRange);if(z)l=v,a.isSelectionValid=function(a){var b=t(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||p(c.createRange().parentElement())==b};else{if(!x)return b.fail("Neither document.selection or window.getSelection() detected."),!1;l=u,a.isSelectionValid=function(){return!0}}a.getNativeSelection=l;var A=l();if(!A)return b.fail("Native selection was null (possibly issue 138?)"),!1;var B=a.createNativeRange(document),C=q(document),D=f.areHostProperties(A,["anchorNode","focusNode","anchorOffset","focusOffset"]);n.selectionHasAnchorAndFocus=D;var E=g(A,"extend");n.selectionHasExtend=E;var F=typeof A.rangeCount==d;n.selectionHasRangeCount=F;var G=!1,H=!0,I=E?function(b,c){var d=h.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(O(e)),b.extend(c.startContainer,c.startOffset)}:null;f.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&typeof A.rangeCount==d&&n.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=c>1,f=[],g=w(b),h=0;h<c;++h)f[h]=b.getRangeAt(h);var i=e.createTestElement(document,"",!1),j=i.appendChild(document.createTextNode("   ")),k=document.createRange();if(k.setStart(j,1),k.collapse(!0),b.removeAllRanges(),b.addRange(k),H=1==b.rangeCount,b.removeAllRanges(),!d){var l=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(l&&parseInt(l[1])>=36)G=!1;else{var m=k.cloneRange();k.setStart(j,0),m.setEnd(j,3),m.setStart(j,2),b.addRange(k),b.addRange(m),G=2==b.rangeCount}}for(e.removeNode(i),b.removeAllRanges(),h=0;h<c;++h)0==h&&g?I?I(b,f[h]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(f[h])):b.addRange(f[h])}}(),n.selectionSupportsMultipleRanges=G,n.collapsedNonEditableSelectionsSupported=H;var K,J=!1;C&&g(C,"createControlRange")&&(K=C.createControlRange(),f.areHostProperties(K,["item","add"])&&(J=!0)),n.implementsControlRange=J,m=D?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return!!a.rangeCount&&a.getRangeAt(a.rangeCount-1).collapsed};var V;g(A,"getRangeAt")?V=function(a,b){try{return a.getRangeAt(b)}catch(a){return null}}:D&&(V=function(b){var c=p(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),W.prototype=a.selectionPrototype;var Y=[],$=function(a){if(a&&a instanceof W)return a.refresh(),a;a=t(a,"getNativeSelection");var b=Z(a),c=l(a),d=y?v(a):null;return b?(b.nativeSelection=c,b.docSelection=d,b.refresh()):(b=new W(c,d,a),Y.push({win:a,selection:b})),b};a.getSelection=$,f.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection");var _=W.prototype;if(!z&&D&&f.areHostMethods(A,["removeAllRanges","addRange"])){_.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),N(this)};var ba=function(a,b){I(a.nativeSelection,b),a.refresh()};F?_.addRange=function(b,c){if(J&&y&&this.docSelection.type==o)U(this,b);else if(s(c)&&E)ba(this,b);else{var d;G?d=this.rangeCount:(this.removeAllRanges(),d=0);var e=O(b).cloneRange();try{this.nativeSelection.addRange(e)}catch(a){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1){if(a.config.checkSelectionRanges){var f=V(this.nativeSelection,this.rangeCount-1);f&&!r(f,b)&&(b=new i(f))}this._ranges[this.rangeCount-1]=b,L(this,b,ea(this.nativeSelection)),this.isCollapsed=m(this)}else this.refresh()}}:_.addRange=function(a,b){s(b)&&E?ba(this,a):(this.nativeSelection.addRange(O(a)),this.refresh())},_.setRanges=function(a){if(J&&y&&a.length>1)aa(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else{if(!(g(A,"empty")&&g(B,"select")&&J&&z))return b.fail("No means of selecting a Range or TextRange was found"),!1;_.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=p(this.anchorNode);else if(this.docSelection.type==o){var b=this.docSelection.createRange();b.length&&(a=p(b.item(0)))}if(a){var c=q(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(a){}N(this)},_.addRange=function(b){this.docSelection.type==o?U(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,b,!1))},_.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?aa(this,a):b&&this.addRange(a[0])}}_.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new j("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var ca;if(z)ca=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=q(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==o?T(b):R(c)?S(b,c):N(b)};else if(g(A,"getRangeAt")&&typeof A.rangeCount==d)ca=function(b){if(J&&y&&b.docSelection.type==o)T(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));L(b,b._ranges[b.rangeCount-1],ea(b.nativeSelection)),b.isCollapsed=m(b)}else N(b)};else{if(!D||typeof A.isCollapsed!=c||typeof B.collapsed!=c||!n.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ca=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=V(c,0),a._ranges=[b],a.rangeCount=1,M(a),a.isCollapsed=m(a)):N(a)}}_.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(ca(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!r(b[e],this._ranges[e]))return!0;return!1}};var da=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;d<e;++d)r(b,c[d])||a.addRange(c[d]);a.rangeCount||N(a)};J&&y?_.removeRange=function(a){if(this.docSelection.type==o){for(var f,b=this.docSelection.createRange(),c=Q(a),d=p(b.item(0)),e=q(d).createControlRange(),g=!1,h=0,i=b.length;h<i;++h)f=b.item(h),f!==c||g?e.add(b.item(h)):g=!0;e.select(),T(this)}else da(this,a)}:_.removeRange=function(a){da(this,a)};var ea;!z&&D&&n.implementsDomRange?(ea=w,_.isBackward=function(){return ea(this)}):ea=_.isBackward=function(){return!1},_.isBackwards=_.isBackward,_.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")},_.collapse=function(b,c){fa(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},_.collapseToStart=function(){if(!this.rangeCount)throw new j("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},_.collapseToEnd=function(){if(!this.rangeCount)throw new j("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},_.selectAllChildren=function(b){fa(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},_.deleteFromDocument=function(){if(J&&y&&this.docSelection.type==o){for(var b,a=this.docSelection.createRange();a.length;)b=a.item(0),a.remove(b),e.removeNode(b);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,f=c.length;d<f;++d)c[d].deleteContents();this.addRange(c[f-1])}}},_.eachRange=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(a(this.getRangeAt(c)))return b},_.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},_.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},_.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b||[]))}),c},_.setStart=ga(!0),_.setEnd=ga(!1),a.rangePrototype.select=function(a){$(this.getDocument()).setSingleRange(this,a)},_.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},_.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1},_.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},_.moveToBookmark=function(b){for(var e,f,c=[],d=0;e=b.rangeBookmarks[d++];)f=a.createRange(this.win),f.moveToBookmark(e),c.push(f);b.backward?this.setSingleRange(c[0],"backward"):this.setRanges(c)},_.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},_.restoreRanges=function(a){this.removeAllRanges();for(var c,b=0;c=a.ranges[b];++b)this.addRange(c,a.backward&&0==b)},_.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(h.toHtml(b))}),a.join("")},n.implementsTextRange&&(_.getNativeTextRange=function(){var c;if(c=this.docSelection){var e=c.createRange();if(R(e))return e;throw b.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range")}),_.getName=function(){return"WrappedSelection"},_.inspect=function(){return ha(this)},_.detach=function(){Z(this.win,"delete"),X(this)},W.detachAll=function(){Z(null,"deleteAll")},W.inspect=ha,W.isDirectionBackward=s,a.Selection=W,a.selectionPrototype=_,a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return $(a)}),a=null})});var M=!1,N=function(a){M||(M=!0,!u.initialized&&u.config.autoInitialize&&D())};return s&&("complete"==document.readyState?N():(h(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",N,!1),A(window,"load",N))),u},this),function(a,b){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(b.rangy)}(function(a){return a.createModule("ClassApplier",["WrappedSelection"],function(a,b){function k(a,b){for(var c in a)if(a.hasOwnProperty(c)&&b(c,a[c])===!1)return!1;return!0}function l(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function m(a,b){return!!a&&new RegExp("(?:^|\\s)"+b+"(?:\\s|$)").test(a)}function n(a,b){if("object"==typeof a.classList)return a.classList.contains(b);var c="string"==typeof a.className,d=c?a.className:a.getAttribute("class");return m(d,b)}function o(a,b){if("object"==typeof a.classList)a.classList.add(b);else{var c="string"==typeof a.className,d=c?a.className:a.getAttribute("class");d?m(d,b)||(d+=" "+b):d=b,c?a.className=d:a.setAttribute("class",d)}}function q(a){var b="string"==typeof a.className;return b?a.className:a.getAttribute("class")}function r(a){return a&&a.split(/\s+/).sort().join(" ")}function s(a){return r(q(a))}function t(a,b){return s(a)==s(b)}function u(a,b){for(var c=b.split(/\s+/),d=0,e=c.length;d<e;++d)if(!n(a,l(c[d])))return!1;return!0}function v(a){var b=a.parentNode;return b&&1==b.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(b.nodeName)}function w(a,b,c,d,e){var f=a.node,g=a.offset,h=f,i=g;f==d&&g>e&&++i,f!=b||g!=c&&g!=c+1||(h=d,i+=e-c),f==b&&g>c+1&&--i,a.node=h,a.offset=i}function x(a,b,c){a.node==b&&a.offset>c&&--a.offset}function y(a,b,d,e){d==-1&&(d=b.childNodes.length);var f=a.parentNode,h=c.getNodeIndex(a);g(e,function(a){w(a,f,h,b,d)}),b.childNodes.length==d?b.appendChild(a):b.insertBefore(a,b.childNodes[d])}function z(a,b){var d=a.parentNode,e=c.getNodeIndex(a);g(b,function(a){x(a,d,e)}),c.removeNode(a)}function A(a,b,c,d,e){for(var f,g=[];f=a.firstChild;)y(f,b,c++,e),g.push(f);return d&&z(a,e),g}function B(a,b){return A(a,a.parentNode,c.getNodeIndex(a),!0,b)}function C(a,b){var c=a.cloneRange();c.selectNodeContents(b);var d=c.intersection(a),e=d?d.toString():"";return""!=e}function D(a){for(var d,b=a.getNodes([3]),c=0;(d=b[c])&&!C(a,d);)++c;for(var e=b.length-1;(d=b[e])&&!C(a,d);)--e;return b.slice(c,e+1)}function E(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var e,f,g,c=0,d=a.attributes.length;c<d;++c)if(e=a.attributes[c],g=e.name,"class"!=g){if(f=b.attributes.getNamedItem(g),null===e!=(null===f))return!1;if(e.specified!=f.specified)return!1;if(e.specified&&e.nodeValue!==f.nodeValue)return!1}return!0}function F(a,b){for(var f,c=0,d=a.attributes.length;c<d;++c)if(f=a.attributes[c].name,(!b||!e(b,f))&&a.attributes[c].specified&&"class"!=f)return!0;return!1}function I(a){var b;return a&&1==a.nodeType&&((b=a.parentNode)&&9==b.nodeType&&"on"==b.designMode||H(a)&&!H(a.parentNode))}function J(a){return(H(a)||1!=a.nodeType&&H(a.parentNode))&&!I(a)}function L(a){return a&&1==a.nodeType&&!K.test(G(a,"display"))}function N(a){if(0==a.data.length)return!0;if(M.test(a.data))return!1;var b=G(a.parentNode,"whiteSpace");switch(b){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(a.data))return!1}return L(a.previousSibling)||L(a.nextSibling)}function O(a){var c,e,b=[];for(c=0;e=a[c++];)b.push(new d(e.startContainer,e.startOffset),new d(e.endContainer,e.endOffset));return b}function P(a,b){for(var d,e,f,c=0,g=a.length;c<g;++c)d=a[c],e=b[2*c],f=b[2*c+1],d.setStartAndEnd(e.node,e.offset,f.node,f.offset)}function Q(a,b){return c.isCharacterDataNode(a)?0==b?!!a.previousSibling:b!=a.length||!!a.nextSibling:b>0&&b<a.childNodes.length}function R(a,d,e,f){var g,h,i=0==e;if(c.isAncestorOf(d,a))return a;if(c.isCharacterDataNode(d)){var j=c.getNodeIndex(d);if(0==e)e=j;else{if(e!=d.length)throw b.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+e+" in "+d.data);e=j+1}d=d.parentNode}if(Q(d,e)){g=d.cloneNode(!1),h=d.parentNode,g.id&&g.removeAttribute("id");for(var k,l=0;k=d.childNodes[e];)y(k,g,l++,f);return y(g,h,c.getNodeIndex(d)+1,f),d==a?g:R(a,h,c.getNodeIndex(g),f)}if(a!=d){g=d.parentNode;var m=c.getNodeIndex(d);return i||m++,R(a,g,m,f)}return a}function S(a,b){return a.namespaceURI==b.namespaceURI&&a.tagName.toLowerCase()==b.tagName.toLowerCase()&&t(a,b)&&E(a,b)&&"inline"==G(a,"display")&&"inline"==G(b,"display")}function T(a){var b=a?"nextSibling":"previousSibling";return function(c,d){var e=c.parentNode,f=c[b];if(f){if(f&&3==f.nodeType)return f}else if(d&&(f=e[b],f&&1==f.nodeType&&S(e,f))){var g=f[a?"firstChild":"lastChild"];if(g&&3==g.nodeType)return g}return null}}function W(a){this.isElementMerge=1==a.nodeType,this.textNodes=[];var b=this.isElementMerge?a.lastChild:a;b&&(this.textNodes[0]=b)}function Z(a,b,c){var d,e,f,g,h=this;h.cssClass=h.className=a;var i=null,j={};if("object"==typeof b&&null!==b){for("undefined"!=typeof b.elementTagName&&(b.elementTagName=b.elementTagName.toLowerCase()),c=b.tagNames,i=b.elementProperties,j=b.elementAttributes,e=0;g=X[e++];)b.hasOwnProperty(g)&&(h[g]=b[g]);d=b.normalize}else d=b;h.normalize="undefined"==typeof d||d,h.attrExceptions=[];var m=document.createElement(h.elementTagName);h.elementProperties=h.copyPropertiesToElement(i,m,!0),k(j,function(a,b){h.attrExceptions.push(a),j[a]=""+b}),h.elementAttributes=j,h.elementSortedClassName=h.elementProperties.hasOwnProperty("className")?r(h.elementProperties.className+" "+a):a,h.applyToAnyTagName=!1;var n=typeof c;if("string"==n)"*"==c?h.applyToAnyTagName=!0:h.tagNames=l(c.toLowerCase()).split(/\s*,\s*/);else if("object"==n&&"number"==typeof c.length)for(h.tagNames=[],e=0,f=c.length;e<f;++e)"*"==c[e]?h.applyToAnyTagName=!0:h.tagNames.push(c[e].toLowerCase());else h.tagNames=[h.elementTagName]}function $(a,b,c){return new Z(a,b,c)}var c=a.dom,d=c.DomPosition,e=c.arrayContains,f=a.util,g=f.forEach,h="span",j=f.isHostMethod(document,"createElementNS"),p=function(){function a(a,b,c){return b&&c?" ":""}return function(b,c){if("object"==typeof b.classList)b.classList.remove(c);else{var d="string"==typeof b.className,e=d?b.className:b.getAttribute("class");e=e.replace(new RegExp("(^|\\s)"+c+"(\\s|$)"),a),d?b.className=e:b.setAttribute("class",e)}}}(),G=c.getComputedStyleProperty,H=function(){var a=document.createElement("div");return"boolean"==typeof a.isContentEditable?function(a){return a&&1==a.nodeType&&a.isContentEditable}:function(a){return!(!a||1!=a.nodeType||"false"==a.contentEditable)&&("true"==a.contentEditable||H(a.parentNode))}}(),K=/^inline(-block|-table)?$/i,M=/[^\r\n\t\f \u200B]/,U=T(!1),V=T(!0);W.prototype={doMerge:function(a){var b=this.textNodes,d=b[0];if(b.length>1){var j,e=c.getNodeIndex(d),f=[],h=0;g(b,function(b,i){j=b.parentNode,i>0&&(j.removeChild(b),j.hasChildNodes()||c.removeNode(j),a&&g(a,function(a){a.node==b&&(a.node=d,a.offset+=h),a.node==j&&a.offset>e&&(--a.offset,a.offset==e+1&&i<len-1&&(a.node=d,a.offset=h))})),f[i]=b.data,h+=b.data.length}),d.data=f.join("")}return d.data},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){var a=[];return g(this.textNodes,function(b,c){a[c]="'"+b.data+"'"}),"[Merge("+a.join(",")+")]"}};var X=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],Y={};Z.prototype={elementTagName:h,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(a,b,c){var d,e,g,h,i,j,f={};for(var k in a)if(a.hasOwnProperty(k))if(h=a[k],i=b[k],"className"==k)o(b,h),o(b,this.className),b[k]=r(b[k]),c&&(f[k]=h);else if("style"==k){e=i,c&&(f[k]=g={});for(d in a[k])a[k].hasOwnProperty(d)&&(e[d]=h[d],c&&(g[d]=e[d]));this.attrExceptions.push(k)}else b[k]=h,c&&(f[k]=b[k],j=Y.hasOwnProperty(k)?Y[k]:k,this.attrExceptions.push(j));return c?f:""},copyAttributesToElement:function(a,b){for(var c in a)a.hasOwnProperty(c)&&!/^class(?:Name)?$/i.test(c)&&b.setAttribute(c,a[c])},appliesToElement:function(a){return e(this.tagNames,a.tagName.toLowerCase())},getEmptyElements:function(a){var b=this;return a.getNodes([1],function(a){return b.appliesToElement(a)&&!a.hasChildNodes()})},hasClass:function(a){return 1==a.nodeType&&(this.applyToAnyTagName||this.appliesToElement(a))&&n(a,this.className)},getSelfOrAncestorWithClass:function(a){for(;a;){if(this.hasClass(a))return a;a=a.parentNode}return null},isModifiable:function(a){return!this.applyToEditableOnly||J(a)},isIgnorableWhiteSpaceNode:function(a){return this.ignoreWhiteSpace&&a&&3==a.nodeType&&N(a)},postApply:function(a,b,c,d){var j,p,e=a[0],f=a[a.length-1],h=[],k=e,l=f,m=0,n=f.length;g(a,function(a){p=U(a,!d),p?(j||(j=new W(p),h.push(j)),j.textNodes.push(a),a===e&&(k=j.textNodes[0],m=k.length),a===f&&(l=j.textNodes[0],n=j.getLength())):j=null});var q=V(f,!d);if(q&&(j||(j=new W(f),h.push(j)),j.textNodes.push(q)),h.length){for(i=0,len=h.length;i<len;++i)h[i].doMerge(c);b.setStartAndEnd(k,m,l,n)}},createContainer:function(a){var d,b=c.getDocument(a),e=j&&!c.isHtmlNamespace(a)&&(d=a.namespaceURI)?b.createElementNS(a.namespaceURI,this.elementTagName):b.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,e,!1),this.copyAttributesToElement(this.elementAttributes,e),o(e,this.className),this.onElementCreate&&this.onElementCreate(e,this),e},elementHasProperties:function(a,b){var c=this;return k(b,function(b,d){if("className"==b)return u(a,d);if("object"==typeof d){if(!c.elementHasProperties(a[b],d))return!1}else if(a[b]!==d)return!1})},elementHasAttributes:function(a,b){return k(b,function(b,c){if(a.getAttribute(b)!==c)return!1})},applyToTextNode:function(a,b){if(v(a)){var c=a.parentNode;if(1==c.childNodes.length&&this.useExistingElements&&this.appliesToElement(c)&&this.elementHasProperties(c,this.elementProperties)&&this.elementHasAttributes(c,this.elementAttributes))o(c,this.className);else{var d=a.parentNode,e=this.createContainer(d);d.insertBefore(e,a),e.appendChild(a)}}},isRemovable:function(a){return a.tagName.toLowerCase()==this.elementTagName&&s(a)==this.elementSortedClassName&&this.elementHasProperties(a,this.elementProperties)&&!F(a,this.attrExceptions)&&this.elementHasAttributes(a,this.elementAttributes)&&this.isModifiable(a)},isEmptyContainer:function(a){var b=a.childNodes.length;return 1==a.nodeType&&this.isRemovable(a)&&(0==b||1==b&&this.isEmptyContainer(a.firstChild))},removeEmptyContainers:function(a){var b=this,c=a.getNodes([1],function(a){return b.isEmptyContainer(a)}),d=[a],e=O(d);g(c,function(a){z(a,e)}),P(d,e)},undoToTextNode:function(a,b,c,d){if(!b.containsNode(c)){var e=b.cloneRange();e.selectNode(c),e.isPointInRange(b.endContainer,b.endOffset)&&(R(c,b.endContainer,b.endOffset,d),b.setEndAfter(c)),e.isPointInRange(b.startContainer,b.startOffset)&&(c=R(c,b.startContainer,b.startOffset,d))}this.isRemovable(c)?B(c,d):p(c,this.className)},splitAncestorWithClass:function(a,b,c){var d=this.getSelfOrAncestorWithClass(a);d&&R(d,a,b,c)},undoToAncestor:function(a,b){this.isRemovable(a)?B(a,b):p(a,this.className)},applyToRange:function(a,b){var c=this;b=b||[];var d=O(b||[]);a.splitBoundariesPreservingPositions(d),c.removeEmptyElements&&c.removeEmptyContainers(a);var e=D(a);if(e.length){g(e,function(a){c.isIgnorableWhiteSpaceNode(a)||c.getSelfOrAncestorWithClass(a)||!c.isModifiable(a)||c.applyToTextNode(a,d)});var f=e[e.length-1];a.setStartAndEnd(e[0],0,f,f.length),c.normalize&&c.postApply(e,a,d,!1),P(b,d)}var h=c.getEmptyElements(a);g(h,function(a){o(a,c.className)})},applyToRanges:function(a){for(var b=a.length;b--;)this.applyToRange(a[b],a);return a},applyToSelection:function(b){var c=a.getSelection(b);c.setRanges(this.applyToRanges(c.getAllRanges()))},undoToRange:function(a,b){var c=this;b=b||[];var d=O(b);a.splitBoundariesPreservingPositions(d),c.removeEmptyElements&&c.removeEmptyContainers(a,d);var f,h,e=D(a),i=e[e.length-1];if(e.length){c.splitAncestorWithClass(a.endContainer,a.endOffset,d),c.splitAncestorWithClass(a.startContainer,a.startOffset,d);for(var j=0,k=e.length;j<k;++j)f=e[j],h=c.getSelfOrAncestorWithClass(f),h&&c.isModifiable(f)&&c.undoToAncestor(h,d);a.setStartAndEnd(e[0],0,i,i.length),c.normalize&&c.postApply(e,a,d,!0),P(b,d)}var l=c.getEmptyElements(a);g(l,function(a){p(a,c.className)})},undoToRanges:function(a){for(var b=a.length;b--;)this.undoToRange(a[b],a);return a},undoToSelection:function(b){var c=a.getSelection(b),d=a.getSelection(b).getAllRanges();this.undoToRanges(d),c.setRanges(d)},isAppliedToRange:function(a){if(a.collapsed||""==a.toString())return!!this.getSelfOrAncestorWithClass(a.commonAncestorContainer);var b=a.getNodes([3]);if(b.length)for(var d,c=0;d=b[c++];)if(!this.isIgnorableWhiteSpaceNode(d)&&C(a,d)&&this.isModifiable(d)&&!this.getSelfOrAncestorWithClass(d))return!1;return!0},isAppliedToRanges:function(a){var b=a.length;if(0==b)return!1;for(;b--;)if(!this.isAppliedToRange(a[b]))return!1;return!0},isAppliedToSelection:function(b){var c=a.getSelection(b);return this.isAppliedToRanges(c.getAllRanges())},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},getElementsWithClassIntersectingRange:function(a){var b=[],c=this;return a.getNodes([3],function(a){var d=c.getSelfOrAncestorWithClass(a);d&&!e(b,d)&&b.push(d)}),b},detach:function(){}},Z.util={hasClass:n,addClass:o,removeClass:p,getClass:q,hasSameClasses:t,hasAllClasses:u,replaceWithOwnChildren:B,elementsHaveSameNonClassAttributes:E,elementHasNonClassAttributes:F,splitNodeAt:R,isEditableElement:H,isEditingHost:I,isEditable:J},a.CssClassApplier=a.ClassApplier=Z,a.createClassApplier=$,f.createAliasForDeprecatedMethod(a,"createCssClassApplier","createClassApplier",b)}),a},this);